% Main LaTeX source file for avoid_time_t.pdf

% Copyright Â© 2024 by John Sauter.
% Licensed under the Creative Commons Attribution-ShareAlike 4.0 International
% license.  See https://creativecommons.org/license/by-sa/4.0/.

\documentclass[letterpaper,twoside]{article}
\usepackage{fontspec}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage[english]{babel}
\usepackage{color}
\usepackage{multicol}
\usepackage{array}
\usepackage{longtable}
\usepackage{embedfile}
\usepackage{enumitem}
\usepackage[super]{nth}
\usepackage{fancyhdr}
\usepackage{xfrac}
\usepackage{fnpct}
\usepackage{siunitx}
\usepackage{graphics}
\usepackage{natbib}
\usepackage[kpsewhich=true]{minted}
\usepackage[tracking]{microtype}
\usepackage{hyphenat}
\usepackage{fancyvrb}
\usepackage{relsize}
\usepackage{hyperxmp}
%\usepackage{flexisym}

% Font choices: pick one.

% 1. Latin Modern matches Don Knuth's Computer Modern
%\usepackage{unicode-math}
%\setmainfont{Latin Modern Roman}[SmallCapsFont={Latin Modern Roman Caps}]
%\setmonofont{Latin Modern Mono}
%\setmathfont{Latin Modern Math}
%\newcommand{\filename}{\ttfamily\smaller}

% 2. Libertine
%\usepackage{unicode-math}
%\setmainfont[Ligatures={Common},Numbers=Proportional]{Linux Libertine O}
%\setsansfont{Linux Biolinum O}
%\setmathfont[Scale=MatchUppercase]{libertinusmath-regular.otf}
%\newcommand{\filename}{\ttfamily}

% 3. Garamond Libre
%\usepackage{unicode-math}
%\usepackage{garamondlibre}
%\newcommand{\filename}{\ttfamily}

% 4. Old Standard
% Small caps doesn't work.
%\usepackage{unicode-math}
%\setmainfont{OldStandard}
%\newcommand{\filename}{\ttfamily}

% 5. Liberation
% Small caps doesn't work.
%\usepackage{unicode-math}
%\defaultfontfeatures{Scale=MatchLowercase}
%\setmainfont{Liberation Serif}
%\setsansfont{Liberation Sans}
%\setmonofont[SmallCapsFont={Liberation Mono}]{Liberation Mono}
%\newcommand{\filename}{\ttfamily}

% 6. GNU Freefont
%\usepackage{unicode-math}
%\setmainfont{FreeSerif}
%\setsansfont{FreeSans}
%\setmonofont{FreeMono}
%\newcommand{\filename}{\ttfamily\smaller}
%\renewcommand{\RSpercentTolerance}{0}

% 7. Andika
%\usepackage{unicode-math}
%\setmainfont{Andika}
%\newcommand{\filename}{\ttfamily\smaller}

% 8. Bahnschrift
%\usepackage{unicode-math}
%\setmainfont{Bahnschrift}
%\newcommand{\filename}{\ttfamily}

% 9. Charis Sil
%\usepackage{unicode-math}
%\setmainfont{Charis Sil}
%\newcommand{\filename}{\ttfamily}

% 10. E B Garamond
\usepackage{unicode-math}
\setmainfont{ebgaramond}
\setsansfont{Charis Sil}
\setmonofont[SmallCapsFont={Liberation Mono}]{source code pro}
\setmathfont{Garamond-Math.otf}
\newcommand{\filename}{\ttfamily\smaller}

\usepackage[pdfencoding=unicode,pagebackref,breaklinks]{hyperref}
\bibliographystyle{plainnat}
\setcitestyle{numbers,square}
% Pages styles
%\setlength{\headheight}{22.5pt}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE]{\thepage}
\fancyhead[CE]{{\scshape John Sauter}}
\fancyhead[CO]{{\scshape Avoid Using POSIX {\ttfamily time\_t}
    for Telling Time}}
\fancyhead[RO]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot{}
\setlength\tabcolsep{1mm}
\renewcommand\arraystretch{1.3}

\begin{document}
\embedfile[desc={Avoid Using POSIX time\_t for Telling Time},
  mimetype={text/plain},
  ucfilespec={avoid\_time\_t.tex}]
          {avoid_time_t.tex}
\title{Avoid Using POSIX {\ttfamily time\_t} for Telling
  Time\footnote{Copyright
    {\copyright} 2024 by John Sauter.
    This paper is made available under a
    Creative Commons Attribution-ShareAlike 4.0 International License.
    You can read a human-readable summary of the license at
    \href{https://creativecommons.org/licenses/by-sa/4.0}{https://creativecommons.org/licenses/by-sa/4.0},
    which contains a link to the full text of the license.
    See also section \ref{section:Licensing} of this paper.}
}
\author{John Sauter\footnote{
    System Eyes Computer Store,
    20A Northwest Blvd.  Ste 345,
    Nashua, NH  03063-4066,
    e-mail: John\_Sauter@systemeyescomputerstore.com,
    telephone: (603) 424-1188}}
\hypersetup{unicode=true,
  pdfauthor={John Sauter},
  pdftitle={Avoid Using POSIX time\_t for Telling Time},
  pdfsubject={POSIX time\_t},
  pdfkeywords={Coordinated Universal Time, UTC, POSIX, time\_t},
  pdfcontactaddress={System Eyes Computer Store, 20A Northwest Blvd.  Ste 345},
  pdfcontactcity={Nashua},
  pdfcontactcountry={USA},
  pdfcontactemail={John\_Sauter@systemeyescomputerstore.com},
  pdfcontactphone={603-424-1188},
  pdfcontactpostcode={03063-4066},
  pdfcontactregion={New Hampshire},
  pdfcontacturl={https://www.systemeyescomputerstore.com},
  pdfcopyright={Copyright {\copyright} 2024 by John Sauter},
  pdfurl={https://www.systemeyescomputerstore.com/leap\%5Fseconds/proleptic\%5FUTC.pdf},
  pdfdate={2024-01-05},
  pdflicenseurl={https://creativecommons.org/licenses/by-sa/4.0},
  pdfmetalang={en-US}
}

\date{2024-01-05}
\maketitle
\begin{abstract}
  The POSIX data type {\ttfamily time\_t} is defined in a way that leads
  to errors in application programs when it is used for telling time.
  Here is how to avoid using it for that purpose.
\end{abstract}
\begin{description}
\item[Keywords:]Coordinated Universal Time; UTC; POSIX; time\_t.
\item[URL:]\href{https://www.systemeyescomputerstore.com/leap\_seconds/avoid\_time\_t.pdf}{https://www.systemeyescomputerstore.com/leap\_seconds/avoid\_time\_t.pdf}
\end{description}
%\tableofcontents
\newpage

\section{Definition of {\ttfamily time\_t}}
The data type {\ttfamily time\_t} is defined in POSIX\citep{7582338}
as a count of seconds.
When telling time, it is the number of seconds
since the Epoch, which is approximately midnight Greenwich Mean Time on
January 1, 1970.  This count of seconds since the Epoch is also
defined as an encoding of Coordinated Universal Time into an integer.

The following subsection is the formal definition of ``Seconds
since the Epoch'' from POSIX:

\begin{center}
  {\large * * * * * Beginning of POSIX text * * * * *}
\end{center}

{\setmainfont{Old Standard}[SmallCapsFont={Latin Modern Roman Caps}]
  \rmfamily
  
  \subsection*{4.16 Seconds Since the Epoch}
  A value that approximates the number
  of seconds that have elapsed
  since the Epoch. A Coordinated Universal Time name
  (specified in terms of seconds ({\itshape tm\_sec}),
  minutes ({\itshape tm\_min}),
  hours ({\itshape tm\_hour}), days since January 1 of the year
  ({\itshape tm\_yday}),
  and calendar year minus 1900 ({\itshape tm\_year})) is related to a time
  represented as seconds since the Epoch, according to the expression below.

  If the year is $< 1970$ or the value is negative, the relationship is
  undefined.
  If the year is $\geq 1970$ and the value is non-negative, the value is
  related to a Coordinated Universal Time name according to the
  C-language expression, where {\itshape tm\_sec}, {\itshape tm\_min},
  {\itshape tm\_hour},
  {\itshape tm\_yday}, and {\itshape tm\_year} are all integer types:
  \begin{multline*}
    tm\_sec + tm\_min*60 + tm\_hour*3600 + tm\_yday*86400 \,+ \\
    (tm\_year-70)*31536000 + ((tm\_year-69)/4)*86400 \,- \\
    ((tm\_year-1)/100)*86400 + ((tm\_year+299)/400)*86400
  \end{multline*}
  The relationship between the actual time of day and the current value
  for seconds since the Epoch is unspecified.

  How any changes to the value of seconds since the Epoch are made
  to align to a desired relationship with the current actual time
  is implementation-defined. As represented in seconds since the Epoch,
  each and every day shall be accounted for by exactly \num{86400} seconds.
  
  \begin{description}
  \item[Note:]
    The last three terms of the expression add in a day for each year
    that follows a leap year starting with the first leap year since
    the Epoch. The first term adds a day every 4 years starting in 1973,
    the second subtracts a day back out every 100 years starting in 2001,
    and the third adds a day back in every 400 years starting in 2001.
    The divisions in the formula are integer divisions; that is, the
    remainder is discarded leaving only the integer quotient.
  \end{description}

}

\begin{center}
  {\large * * * * * End of POSIX text * * * * *}
\end{center}

\section{Problems}
There are several problems with this definition:
\begin{itemize}
\item{It is not defined for years before 1970.}
\item{The relationship between the actual time of day and the current value
  for seconds since the Epoch is unspecified.
  This means it can vary from time to time
  and from one implementation to another, making the
  relationship meaningless.}
\item{An application using {\ttfamily time\_t} is required to pretend that
  all days
  contain exactly \num{86400} seconds.  This is false: December 31, 2016, for
  example, contains \num{86401} seconds.  This pretense leads to application
  program errors on days that do not contain \num{86400} seconds.
  Because {\ttfamily time\_t} counts seconds almost all the time,
  application programmers
  are tempted to use it as though it always counts seconds,
  leading to errors in the application when it doesn't.}
\item{Because the epoch is undefined, an implementation can change
  it while an application is running, so that time seems to step
  backwards.  One can forgive an application which fails when this
  happens.}
\end{itemize}

\section{Solutions}
The major reason for the problems with {\ttfamily time\_t} is that it is
trying to do
too much: be a count of seconds and encode Coordinated Universal Time.
The first stage in solving the problems is to separate these two jobs.

\subsection{Encoding Coordinated Universal Time}
A good way to represent Coordinated Universal Time is with the
POSIX {\ttfamily tm} data
structure.  It contains integers for the year, month, day, hour, minute
and second.  To encode it into an integer you can do this:
\begin{multline*}
  value = (year \times 10000000000) + (month \times 100000000) \, + \\
  (day \times 1000000) + (hour \times 10000) + (minute \times 100) + second
\end{multline*}
The value computed above is defined for all years, has a clear relationship
to the date and time of day, and does not require an application to pretend
that all days have \num{86400} seconds.  Its values are very different from
the value of a {\ttfamily time\_t}, and so are not likely to be mistaken for it,
or vice-versa.  It does not count seconds for more than a minute, so
application programmers will not be tempted to misuse it for that purpose.

An alternative coding of time as an integer is based on International
Atomic Time.  See section \ref{section:International Atomic Time}.

\subsection{Measuring Time}
Application programmers need a way to measure time intevals.
If the interval starts and ends during the execution of an application,
CLOCK\_BOOTTIME
can be used, since it is a count of seconds since an arbitrary epoch.
Unlike {\ttfamily time\_t}, CLOCK\_BOOTTIME does not change its epoch while
applications are running, and so it never appears to flow
backwards.  However, CLOCK\_BOOTTIME is not good for writing to a file
or sending
over a network to another computer, since each computer will have
its own epoch, and that epoch will change when the computer is restarted.
For those purposes it is best to use Coordinated Universal Time.

To measure the time between two instants of Coordinated Universal Time
requires a table of days whose lengths are not \num{86400} seconds.
This table
can be used to adjust for the number of leap seconds that have occurred
during the interval.

\section{Implementing the Solutions}
The solutions presented above are adequate only if they will allow an
application
programmer to avoid completely the use of {\ttfamily time\_t} for telling time.
To demonstrate that this is possible,
I will list all of the POSIX functions 
that use {\ttfamily time\_t}
(or timespec, which contains a {\ttfamily time\_t}) 
and show how to
replace the application functions which use {\ttfamily time\_t} as
seconds since the epoch.
For the convenience of the reader I have packaged the demonstration code
below into a library called {\ttfamily libtime}.
See section \ref{section:Embedded_files} for details.

\subsection{clock\_getres}
This function returns a timespec, but that timespec describes an interval
rather than an instant.  The {\ttfamily time\_t} returned in the timespec is a
number of seconds rather than seconds since the epoch.

\subsection{clock\_gettime and gettimeofday}
Gettimeofday is equivalent to clock\_gettime with clock ID set to
CLOCK\_REAL\-TIME, except for the time zone, which should not be used.

Clock\_gettime with clock ID set to CLOCK\_REAL\-TIME can be replaced by
a function which returns the current time in a {\ttfamily tm} structure along
with the number of nanoseconds since the last second.
\inputminted[firstline=34]{c}{src/time_current_tm_nano.c}
\embedfile[desc={Return the current time including nanoseconds},
  mimetype={text/plain},
  ucfilespec={src/time\_current\_tm\_nano.c}]
          {src/time_current_tm_nano.c}

Notice in the code above the workaround for {\ttfamily adjtimex}
not working.  I feel that it is intolerable for an environment to
conceal the fact that a leap second is in progress, so I recommend
that your application refuse to run in such an environment.  You
can do that by calling the following subroutine at the start
of your program.
\inputminted[firstline=36]{c}{src/time_test_for_disabled_adjtimex.c}
\embedfile[desc={Indicate if adjtimex is disabled},
  mimetype={text/plain},
  ucfilespec={src/time\_test\_for\_disabled\_adjtimex.c}]
          {src/time_test_for_disabled_adjtimex.c}
If the subroutine returns a non-zero result, your applicaton should
complain and exit:
\inputminted[firstline=47,lastline=67]{c}{tests/test_for_disabled_adjtimex.c}
\embedfile[desc={Complain if adjtimex is disabled},
  mimetype={text/plain},
  ucfilespec={tests/test\_for\_disabled\_adjtimex.c}]
          {tests/test_for_disabled_adjtimex.c}
The above subroutine is not included in the library, though
the library does contain
{\ttfamily time\_test\_for\_disabled\_adjtimex}.
Feel free to express yourself as you see fit about the disabling
of {\ttfamily adjtimex}.  Fedora bugzilla
\num{1778298}\footnote{\href{https://bugzilla.redhat.com/show_bug.cgi?id=1778298}{https://bugzilla.redhat.com/show\_bug.cgi?id=1778298}}
contains my opinion.

\subsection{clock\_nanosleep}
Clock\_nanosleep with clock ID set to CLOCK\_REAL\-TIME and with flag
TIMER\_ABS\-TIME not set can be replaced by clock\_nanosleep with
clock ID set to CLOCK\_BOOTTIME, since CLOCK\_BOOTTIME ticks at
same rate as CLOCK\_REAL\-TIME.

Clock\_nanosleep with clock ID set to CLOCK\_REAL\-TIME and with flag
TIMER\_ABS\-TIME set can be replaced by a function which accepts
a time in a {\ttfamily tm} structure and a count of nanoseconds
since that second.
\inputminted[firstline=32]{c}{src/time_sleep_until.c}
\embedfile[desc={Sleep until the specified time},
  mimetype={text/plain},
  ucfilespec={src/time\_sleep\_until.c}]
          {src/time_sleep_until.c}
See subsection \ref{subsection:difftime} for time\_diff
and an explanation of variable\_length\_sec\-onds\_before\_year.

\subsection{clock\_settime}
Clock\_settime is not used by applications.
However, see section \ref{section:KernelRecommendations} for a
recommendation that would make setting the time of day during a
leap second possible.

\subsection{ctime and ctime\_r}
Ctime and ctime\_r can be replaced by a call to localtime followed by
a call to asctime.  See subsection \ref{subsection:localtime}
for the substitute for localtime.
If asctime isn't flexible enough, use strftime or see subsection
\ref{subsection:tostring}

\subsection{difftime}
\label{subsection:difftime}
Difftime can be replaced by a function which returns the time in seconds
between two times expressed using the {\ttfamily tm} structure.
\inputminted[firstline=37]{c}{src/time_diff.c}
\embedfile[desc={Compute the number of seconds between two times},
  mimetype={text/plain},
  ucfilespec={src/time\_diff.c}]
          {src/time_diff.c}
The table of changes in DTAI is too long to present here in full,
but here are some of the lines:
\inputminted[firstline=46156,lastline=46184]{c}{dtai_table.tab}
\embedfile[desc={Table of changes in DTAI, used by time\_diff.c},
  mimetype={text/plain},
  ucfilespec={dtai\_table.tab}]
          {dtai_table.tab}
\embedfile[desc={Size of the table of changes in DTAI},
  mimetype={text/plain},
  ucfilespec={dtai\_table.h}]
          {dtai_table.h}
\embedfile[desc={program to create dtai\_table from extraordinary\_days.dat},
  mimetype={text/plain},
  ucfilespec={read\_extraordinary\_days\_table.py}]
          {read_extraordinary_days_table.py}
\embedfile[desc={table of extraordinary days},
  mimetype={text/plain},
  ucfilespec={extraordinary\_days.dat}]
          {extraordinary_days.dat}
The left number is the integer part of the Julian Day Number of the day
which starts with the new value of DTAI, and the right number is the new
value of DTAI.

The full table of changes in DTAI is embedded in this PDF file;
see section \ref{section:Embedded_files}.
The table can be generated automatically\citep{JBS_001}, but the ultimate
source of its data is based on manually editing a file when the
International Earth Rotation and Reference Systems Service (IERS)
issues its Bulletin
C\footnote{\href{https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html}{https://www.iers.org/IERS/EN/Publications/Bulletins/bulletins.html}}
announcing the next leap second.  See file
{\filename extraordinary\_days.dat}, also embedded in this PDF file,
for details.

\subsection{gmtime and gmtime\_r}
Gmtime and gmtime\_r convert from {\ttfamily time\_t} to
the {\ttfamily tm} structure,
representing Coordinated Universal Time.  We don't
need this function since our primary representation for time is the
{\ttfamily tm} structure representing Coordinated Universal Time,
and we are not using {\ttfamily time\_t}.

\subsection{localtime and localtime\_r}
\label{subsection:localtime}
Localtime and localtime\_r convert a {\ttfamily time\_t} into
a {\ttfamily tm} structure that
represents local time.  We can replace this with a function that takes
as input a {\ttfamily tm} structure that represents Coordinated Universal Time.
If you want the local time in a foreign location you can also specify
the UTC offset.
\inputminted[firstline=32]{c}{src/time_utc_to_local.c}
\embedfile[desc={Convert Coordinated Universal Time to local time},
  mimetype={text/plain},
  ucfilespec={src/time\_utc\_to\_local.c}]
          {src/time_utc_to_local.c}
See subsection \ref{subsection:copy} for time\_copy\_tm,
subsection \ref{subsection:timeUTCadd} for
time\_\-length\_\-prev\_\-UTC\_\-minute,
and subsection \ref{subsection:timelocaladd} for time\_local\_normalize.

\subsection{mktime}
\label{subsection:mktime}
Mktime converts a {\ttfamily tm} structure that represents local time into a
{\ttfamily time\_t}.  We can replace this with a function whose output is a
{\ttfamily tm} structure that represents Coordinated Universal Time.
\inputminted[firstline=32]{c}{src/time_local_to_utc.c}
\embedfile[desc={Convert local time to Coordinated Universal Time},
  mimetype={text/plain},
  ucfilespec={src/time\_local\_to\_utc.c}]
          {src/time_local_to_utc.c}
See subsection \ref{subsection:timeUTCadd} for time\_UTC\_normalize.

\subsection{nanosleep}
Nanosleep takes a timespec as input, but the {\ttfamily time\_t} portion of that
timespec represents the number of seconds to sleep, not an instant of
time.  Similarly, the timespec output represents the number of seconds
remaining in the sleep time.  Both {\ttfamily time\_t} values can be considered
a count of seconds.

\subsection{settimeofday}
Settimeofday is not used by applications.
However, see section \ref{section:KernelRecommendations} for a recommendation
that would make setting the time of day during a leap second possible.

\subsection{stat}
Stat has three timespec fields: atime, mtime and ctime.  The POSIX standard
is rather vague on when the fields are updated to the current time, and
some file systems have precision less than a second for some of the fields.
Your application should not count on these fields being accurate to
the second.  If you need to compare file times, you should do what
rsync does, and implement a modify-window feature, which causes two
file times to compare equal if they differ by no more than the specified
number of seconds.

Some file systems fill in the nanoseconds part of the timespec field,
but you should ignore nanoseconds when comparing because the times may be
inaccurate by up to one second, even on modern file systems.
However, see section \ref{section:KernelRecommendations} for a
recommendation for making the file times accurate.

\subsection{strftime}
Strftime has formatting code \%s, which outputs the number of seconds
since the Epoch.  Don't use this.

\subsection{time}
Time returns the current time as a {\ttfamily time\_t}.
Instead, return it as a {\ttfamily tm}.
\inputminted[firstline=34]{c}{src/time_current_tm.c}
\embedfile[desc={Return the current time in a tm structure},
  mimetype={text/plain},
  ucfilespec={src/time\_current\_tm.c}]
          {src/time_current_tm.c}

\subsection{timegm}
Timegm converts a {\ttfamily tm} structure containing Coordinated Universal Time
into a {\ttfamily time\_t}.
We don't need it, since we are using the {\ttfamily tm} structure
as our primary representation of time.  However, it is sometimes
convenient to represent time as a single value instead of a structure.
\inputminted[firstline=32]{c}{src/time_tm_to_integer.c}
\embedfile[desc={Convert a time to an integer},
  mimetype={text/plain},
  ucfilespec={src/time\_tm\_to\_integer.c}]
          {src/time_tm_to_integer.c}

The following subroutine goes one step further, by including the
fraction of a second in the value.  Note that this code depends
on having a C compiler which supports 128-bit integers.
\inputminted[firstline=32]{c}{src/time_tm_nano_to_integer.c}
\embedfile[desc={Convert a time to a 128-bit integer},
  mimetype={text/plain},
  ucfilespec={src/time\_tm\_nano\_to\_integer.c}]
          {src/time_tm_nano_to_integer.c}

A 128-bit integer cannot be printed with printf, so here is a subroutine
to convert it to a string.  Note that this code depends on having
a C compiler which supports 128-bit integers.
\inputminted[firstline=32]{c}{src/int128_to_string.c}
\embedfile[desc={Convert a 128-bit integer to a string},
  mimetype={text/plain},
  ucfilespec={src/int128\_to\_string.c}]
          {src/int128_to_string.c}

\section{Beyond POSIX}
Just being able to do all the POSIX functions isn't enough to persuade
application programmers to abandon {\ttfamily time\_t} for telling time.
Application programmers
need a net benefit to make changing worthwhile.  To sweeten the solution,
here are some subroutines to manipulate a time value.

\subsection{Copy a time}
\label{subsection:copy}
Here is how to copy a time value from one {\ttfamily tm} structure to another.
\inputminted[firstline=34]{c}{src/time_copy.c}
\embedfile[desc={Copy a time value from one tm structure to another},
  mimetype={text/plain},
  ucfilespec={src/time\_copy.c}]
          {src/time_copy.c}

\subsection{Adding years, months, days, hours, minutes or seconds}
\label{subsection:timeUTCadd}
If you have a time value stored in a {\ttfamily tm} structure, and it represents
Coordinated Universal Time, you can add to the year, month, day, hour,
minute or second field.  You can decrease these fields by adding a
negative value.  When the target date is invalid, such as February 31,
you can choose whether to round towards the future or towards the past
to get a valid date.
\inputminted[firstline=32]{c}{src/time_utc_add.c}
\embedfile[desc={Change the year, month, day, hour, minute or second
  of a UTC time value},
  mimetype={text/plain},
  ucfilespec={src/time\_utc\_add.c}]
          {src/time_utc_add.c}
The routines above use various time\_length subroutines to determine
the length of the current or previous month or minute.
\inputminted[firstline=32]{c}{src/time_length.c}
\embedfile[desc={Determine the length of the current or previous
  month or minute},
  mimetype={text/plain},
  ucfilespec={src/time\_length.c}]
          {src/time_length.c}

The subroutines above also use time\_UTC\_normalize.
\inputminted[firstline=32]{c}{src/time_utc_normalize.c}
\embedfile[desc={Make sure all of the fields of a tm structure
  are in their valid range},
  mimetype={text/plain},
  ucfilespec={src/time\_utc\_normalize.c}]
          {src/time_utc_normalize.c}

\subsection{Doing the same with local time}
\label{subsection:timelocaladd}
If you have a time value stored in a {\ttfamily tm} structure, and it represents
local time, you can add to the year, month, day, hour, minute or
second field.  You can decrease these fields by adding a negative
value.  When the target date is invalid, such as February 31,
you can choose whether to round towards the future or towards the past
to get a valid date.
\inputminted[firstline=32]{c}{src/time_local_add.c}
\embedfile[desc={Change the year, month, day, hour, minute or second
  of a local time value},
  mimetype={text/plain},
  ucfilespec={src/time\_local\_add.c}]
          {src/time_local_add.c}
The subroutines above use time\_local\_normalize.
\inputminted[firstline=32]{c}{src/time_local_normalize.c}
\embedfile[desc={Make sure all of the fields of a tm structure
  representing a local time are in their valid range},
  mimetype={text/plain},
  ucfilespec={src/time\_local\_normalize.c}]
          {src/time_local_normalize.c}

\subsection{Representing a time as a string}
\label{subsection:tostring}
If you want to send a time to another computer, or write it into a file,
it is convenient to be able to convert it to a string.  Here is how you
can do that.  This subroutine works for both Coordinated Universal Time
and local time.
\inputminted[firstline=34]{c}{src/time_tm_to_string.c}
\embedfile[desc={Convert a time to a string},
  mimetype={text/plain},
  ucfilespec={src/time\_tm\_to\_string.c}]
          {src/time_tm_to_string.c}

If you need more precision you can include the nanoseconds:
\inputminted[firstline=34]{c}{src/time_tm_nano_to_string.c}
\embedfile[desc={Convert a precise time to a string},
  mimetype={text/plain},
  ucfilespec={src/time\_tm\_nano\_to\_string.c}]
          {src/time_tm_nano_to_string.c}

\section{International Atomic Time}
\label{section:International Atomic Time}
Applications that are more concerned with measuring time intervals than
with the rotation of the Earth would like a data type like the POSIX
{\ttfamily time\_t} but without leap seconds.  A common way to construct
such a data type is with reference to International Atomic Time, or TAI.

TAI is a time scale which started on January 1, 1958, at 00:00:00 GMT
and has counted fixed-length SI seconds since then.  For the 14 years from
1958 to 1972, UTC used seconds which averaged shorter than the SI seconds,
so by 1972 the two time scales differed by about 10 seconds.  During 1971 the
UTC time scale was made to exactly match the TAI time scale, with an offset of
10 seconds.

Since January 1, 1972 at 00:00:00 UTC, both TAI and UTC have counted
SI seconds, each in its own way.  UTC inserts leap seconds to keep
civil time synchronized to the rotation of the Earth, and TAI does not.
Each time UTC inserts a leap second, the difference between TAI and UTC
increases by one second.  During calendar year 2017 the difference has
been 37 seconds.

UNIX programmers like to use 1970 as a base date, so they backdated the
synchronization of TAI and UTC to January 1, 1970, but kept the 10-second
offset.  Thus, the new data type, which I will call the TAI integer,
is the number of SI seconds since January 1, 1970, plus 10.

The benefit of this data type is that it makes computing the number of
seconds between two times after January 1, 1972 easy: just subtract the
integers.  The tradeoff is that displaying the time in UTC is more difficult.
For example, the TAI integer \num{1483228836} corresponds to December 31, 2016,
at 23:59:60.
See the example in subsection \ref{example:TAI} for this conversion.

\section{List of Entry Points}
For reference, here are the subroutines described above, in
alphabetical order, each with a brief description.
The attribute ``const'' means that the function does not examine
any values except its arguments, and has no effects except
to return a value.  The attribute ``pure'' means the same except
that the function can examine (but not change) global variables.
\inputminted[firstline=37,lastline=283]{c}{time_subroutines.h}
\embedfile[desc={Source for C header file for time subroutines},
  mimetype={text/plain},
  ucfilespec={time\_subroutines.h.in}]
          {time_subroutines.h.in}

\section{Python}
The Python module datetime contains a class also called datetime
which ignores leap seconds, and therefore has the same problem
as POSIX {\ttfamily time\_t}.  A program written in the Python
programming language must therefore refrain from using datetime
in order to handle leap seconds correctly.

You can use the POSIX {\ttfamily tm} data structure in place of datetime,
and use these same C subroutines to manipulate it using
{\ttfamily ctypes}.
Write a module to define the interface, as follows:
\inputminted[firstline=29,lastline=397]{Python}{time_subroutines.py}
\embedfile[desc={Source for module for calling time subroutines from Python},
  mimetype={text/plain},
  ucfilespec={time\_subroutines.py.in}]
          {time_subroutines.py.in}
This file is provided as {\filename time\_subroutines.py}.
Import ctypes and the module, and you can then call the subroutines
from Python.  Here is a Python script to demonstrate this:
\inputminted[firstline=27,lastline=98]{Python}{tests/demo_python.py}
\embedfile[desc={Demonstration Python script},
  mimetype={text/plain},
  ucfilespec={tests/demo\_python.py}]
          {tests/demo_python.py}

Use the Julian Day Number instead of the proleptic Gregorian ordinal
from the datetime module, since it covers a wider span of time.
If you wish to avoid floating point in your dates, you can use
the integer part of the Julian Day Number, with the understanding
that \num{0.5} must be added to get a proper Julian Day Number.
The {\ttfamily tm} structure is always associated with a time zone.

There is a Python example in subsection \ref{example:PTP_using_Python}.
It illustrates conversion from POSIX {\ttfamily tm} to
Python {\ttfamily time.struct\_time}, which is able to represent leap seconds.

\section{Embedded files}
\label{section:Embedded_files}
To save you the trouble of typing in these subroutines, they are embedded
in this PDF file.
Also included are some sample and test programs, and the configuration
scripts needed to compile the programs and construct this PDF file.
Building the PDF file requires {\LaTeX} and Python.

If you have only the PDF file, you can build the time library
and include files as follows:
\begin{enumerate}
\item Install package proleptic\_utc\_with\_leap\_seconds
  to get file {\filename extraordinary\_days.dat} installed.
  You can find a tarball at this URL:
  \href{https://github.com/ShowControl/proleptic_utc_with_leap_seconds}{https://github.com/ShowControl/proleptic\_utc\_with\_leap\_seconds}.
  Like this library it can also be built from its PDF file, which is at
  \href{https://www.systemeyescomputerstore.com/leap\_seconds/proleptic\_UTC.pdf}{https://www.systemeyescomputerstore.com/leap\_seconds/proleptic\_UTC.pdf}.
\item Create an empty directory.
\item Copy the PDF file to it.
\item Create within that directory subdirectories {\filename examples},
{\filename m4}, {\filename src} and {\filename tests}.
\item Extract the embedded files from the PDF file using pdfdetach -saveall.
\item Type {\ttfamily bash fix\_files.sh} to correct the permissions of
  the extracted files.
  \embedfile[desc={Fix permissions of extracted files},
    mimetype={text/plain},
    ucfilespec={fix\_files.sh}]
            {fix_files.sh}
\item Build the library the usual way with {\ttfamily ./configure}
and {\ttfamily make}.
\item Once the library is built you can install it by typing
{\ttfamily sudo make install}.
\end{enumerate}

If you have the compressed tar file, extract its contents to an empty
directory, then type {\ttfamily ./configure},
and {\ttfamily make}.  Type {\ttfamily sudo make install} to
install the library.  If you want the PDF you can get it by
typing {\ttfamily make pdf}.

If you are running the Fedora distribution of GNU/Linux, the code
described in this document is also available in a repository
through the Fedora Copr build service.  To enable the repository,
type {\ttfamily sudo dnf copr enable johnsauter/libtime}.
You need to have dnf-plugins-core installed.
Once the repository is enabled you can type
{\ttfamily sudo dnf install libtime-devel} to install
the library, include files and concise documentation.
To get this PDF file, install {\ttfamily libtime-doc}.
Your users can install {\ttfamily libtime} to get just
the library.  If you are on a platform whose C compiler does
not support 128-bit integers, {\ttfamily int128\_to\_string}
and {\ttfamily time\_tm\_nano\_to\_integer} are not included
in libtime.

\embedfile[desc={Test program},
  mimetype={text/plain},
  ucfilespec={tests/test\_time.c}]{tests/test_time.c}
\embedfile[desc={Test program},
  mimetype={text/plain},
  ucfilespec={tests/test\_JDN.c}]
          {tests/test_JDN.c}
\embedfile[desc={Test program},
  mimetype={text/plain},
  ucfilespec={tests/test\_diff.c}]
          {tests/test_diff.c}
\embedfile[desc={Test program},
  mimetype={text/plain},
  ucfilespec={tests/test\_add.c}]
          {tests/test_add.c}
\embedfile[desc={Test all of the entry points},
  mimetype={text/plain},
  ucfilespec={tests/test\_ep.c}]
          {tests/test_ep.c}
\embedfile[desc={Make sure all lines of source are tested},
  mimetype={text/plain},
  ucfilespec={tests/test\_local.c}]
          {tests/test_local.c}
\embedfile[desc={Regression test program},
  mimetype={text/plain},
  ucfilespec={tests/print\_DTAI.c}]
          {tests/print_DTAI.c}
\embedfile[desc={Sample program: sleep until nearly midnight}
  mimetype={text/plain},
  ucfilespec={tests/sleep\_until\_midnight.c}]
          {tests/sleep_until_midnight.c}
\embedfile[desc={Sample program: print the date of the POSIX epoch}
  mimetype={text/plain},
  ucfilespec={tests/POSIX\_epoch.c}]
          {tests/POSIX_epoch.c}
\embedfile[desc={Sample program: print powers of two}
  mimetype={text/plain},
  ucfilespec={tests/powers\_of\_two.c}]
          {tests/powers_of_two.c}
\embedfile[desc={template configure script for the document, the included
    code and some test and sample programs},
  mimetype={text/plain},
  ucfilespec={configure.ac}]
          {configure.ac}
\embedfile[desc={script to rebuild configure.ac and Makefile.am into
    configure and Makefile},
  mimetype={text/plain},
  ucfilespec={autogen.sh}]
          {autogen.sh}
\embedfile[desc={configure script for the document, the included
    code and some test and sample programs},
  mimetype={text/plain},
  ucfilespec={configure}]
          {configure}
\embedfile[desc={Makefile template for the document, the included code
    and some test and sample programs},
  mimetype={text/plain},
  ucfilespec={Makefile.in}]
          {Makefile.in}
\embedfile[desc={Automake Makefile template for the document,
    the included code and some test and sample programs},
  mimetype={text/plain},
  ucfilespec={Makefile.am}]
          {Makefile.am}
\embedfile[desc={The GPL, version 3},
  mimetype={text/plain},
  ucfilespec={COPYING}]
          {COPYING}
\embedfile[desc={The authors of the package},
  mimetype={text/plain},
  ucfilespec={AUTHORS}]
          {AUTHORS}
\embedfile[desc={Release announcements},
  mimetype={text/plain},
  ucfilespec=NEWS{}]
          {NEWS}
\embedfile[desc={Detailed log of changes},
  mimetype={text/plain},
  ucfilespec={ChangeLog}]
          {ChangeLog}
\embedfile[desc={Basic description of the package},
  mimetype={text/plain},
  ucfilespec={README}]
          {README}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={install-sh}]
          {install-sh}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={missing}]
          {missing}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={config.sub}]
          {config.sub}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={config.h.in}]
          {config.h.in}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={ltmain.sh}]
          {ltmain.sh}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={compile}]
          {compile}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={INSTALL}]
          {INSTALL}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={depcomp}]
          {depcomp}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={config.guess}]
          {config.guess}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={aclocal.m4}]
          {aclocal.m4}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={m4/libtool.m4}]
          {m4/libtool.m4}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={m4/lt\string~obsolete.m4}]
          {m4/lt\string~obsolete.m4}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={m4/ltoptions.m4}]
          {m4/ltoptions.m4}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={m4/ltsugar.m4}]
          {m4/ltsugar.m4}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={m4/ltversion.m4}]
          {m4/ltversion.m4}
\embedfile[desc={install file},
  mimetype={text/plain},
  ucfilespec={py-compile}]
          {py-compile}
\embedfile[desc={MAN file},
  mimetype={text/plain},
  ucfilespec={libtime.3}]
          {libtime.3}
\embedfile[desc={pkg-config file},
  mimetype={text/plain},
  ucfilespec={libtime.pc.in}]
          {libtime.pc.in}
\embedfile[desc={program to check the subroutines work},
  mimetype={text/plain},
  ucfilespec={check\_time.c}]
          {check_time.c}
\embedfile[desc={expected output from check\_time},
  mimetype={text/plain},
  ucfilespec={check\_time\_expected\_output.txt}]
          {check_time_expected_output.txt}
\embedfile[desc={Automake driver for check and distcheck},
  mimetype={text/plain},
  ucfilespec={test-driver}]
          {test-driver}
\embedfile[desc={compare check\_time output with expected output},
  mimetype={text/plain},
  ucfilespec={verify\_files\_template.sh}]
          {verify_files_template.sh}
\embedfile[desc={test the Python interface},
  mimetype={text/plain},
  ucfilespec={tests/test\_python\_interface.py}]
          {tests/test_python_interface.py}
\embedfile[desc={spec file to build RPMs},
  mimetype={text/plain},
  ucfilespec={libtime.spec}]
          {libtime.spec}
\embedfile[desc={bash script to build the RPMs},
  mimetype={text/plain},
  ucfilespec={build\_RPMs.sh}]
          {build_RPMs.sh}
\embedfile[desc={John Sauter's PGP public key, referenced in README},
  mimetype={text/plain},
  ucfilespec={John\_Sauter\_public\_key.asc}]
          {John_Sauter_public_key.asc}

These files are also available on github, at the following URL:
\href{https://github.com/ShowControl/libtime}{https://github.com/ShowControl/libtime}.
That directory has all of the code displayed in this document,
the {\LaTeX} source for this document,
a tarball which holds the sources plus the build and install procedure,
and the source RPM.

\section{Examples}
These examples are intended to illustrate how an application would
use these subroutines to manipulate time represented in a
{\ttfamily tm} structure.

\subsection{Meeting at 9 AM}
You wish to schedule a meeting in the Chrysanthemum Conference Hall
at 9 AM on June 30, 2017.  The participants are all over the world,
so the message sent to their scheduling software will be in
Coordinated Universal Time.  The Chrysanthemum Conference Hall
is located in Tokyo, Japan.

Set your time zone to Asia/Tokyo.  Construct a {\ttfamily tm} structure
containing June 30, 2017, at 9 AM.  Convert that from local time to UTC.
Convert the UTC time to a string, and send the string to
the participants.  The string you send should be 2017-06-30T00:00:00Z.

\subsection{Periodic Backups}
You are writing the scheduler for a backup program.  At 3 AM
local time
after each weekday it does an incremental backup,
except it does a full backup if the last full backup is more
than a month old.  The scheduler is run when the backup program
is installed on the computer, and again when
the current backup has started.  The scheduler is expected
to compute the Coordinated Universal Time at which to start
the next backup, and indicate whether the backup will be
incremental or full.

Compute the current time and convert it to local time.
Set the hour, minute and second to 03:00:00.
Using that as the base, advance by one or more days
until tm\_wday is not Sunday or Monday.  Convert the result
to Coordinated Universal Time.  This is the time of the
next backup.  If you install the software on December 31, 2016,
at 21:21:35 in time zone America/New\_York, the first
scheduled backup will be at 2017-01-03T08:00:00Z.
\inputminted[firstline=44,lastline=76]{c}{examples/example_02.c}
\embedfile[desc={Example code for periodic backups},
  mimetype={text/plain},
  ucfilespec={examples/example\_02.c}]
          {examples/example_02.c}

Subtract one month from the local time computed above, and
convert it to Coordinated Universal Time.  Compute the
difference between this time and the time of the last
full backup.  If the difference is negative, or if there
has never been a full backup, this backup is full;
otherwise it is incremental.
\inputminted[firstline=78,lastline=94]{c}{examples/example_02.c}

\subsection{Rocket over Central Park}
You are asked to explode a fireworks rocket over Central
Park in New York City at exactly 7 PM on the last day of each month.
You place a computer-controlled
rocket launcher on a building adjacent to Central Park.  You know that
the rocket will take exactly two seconds to reach the top of its
arc after it is launched.  The launch computer knows only about Coordinated
Universal Time.  What schedule do you give it for launching in 2016?

Starting with January 31, 2016, in time zone America/New\_York,
step through the months until the year is no longer 2016, rounding
the date down to get the last day of the month.
On each day, set the time to 7 PM, convert to UTC, then subtract
two seconds.  The schedule will accomodate Daylight Saving Time,
the extra day at the end of February,
and the leap second at the end of the year.
\inputminted[firstline=45,lastline=81]{c}{examples/example_03.c}
\embedfile[desc={Example code for rocket over Central Park},
  mimetype={text/plain},
  ucfilespec={examples/example\_03.c}]
          {examples/example_03.c}

Here is the schedule for 2016:
\VerbatimInput[fontsize=\relscale{0.95}]{example_03_output.txt}
\embedfile[desc={Output of example 3},
  mimetype={text/plain},
  ucfilespec={example\_03\_output.txt}]
          {example_03_output.txt}

\subsection{Using International Atomic Time}
\label{example:TAI}
You are writing an application that must compute time intervals quickly,
but can afford to spend more time when displaying a time stamp to a person.
You decide to use a time scale based on International Atomic Time as described
in section \ref{section:International Atomic Time}.  You are using the
integer representation of TAI to time stamp your logs, and you must now convert
those time stamps to readable text.

Construct a base date of January 1, 1970 at 00:00:00.  Add the time stamp
minus 10 to it, specifying that seconds before 1972 are variable length.
Convert the result to text.  The code looks like this:
\inputminted[firstline=41,lastline=67]{c}{examples/example_04.c}
\embedfile[desc={Example code for International Atomic Time},
  mimetype={text/plain},
  ucfilespec={examples/example\_04.c}]
          {examples/example_04.c}

If you find the use of variable-length seconds before 1972 troublesome,
see the next example.

\subsection{Displaying PTP time stamps}
\label{example:PTP}
IEEE 1588, known as Precision Time Protocol or PTP, counts fixed-length
seconds since an epoch.  The SMPTE ST-2059-2 profile specifies that the epoch is
\num{63072010} seconds before January 1, 1972 at 00:00:00 UTC.  That definition
avoids the complexity of variable length seconds before 1972, and is
effectively the same as the TAI integer in the previous example
for dates after January 1, 1972, since there are \num{63072000}
variable-length seconds between January 1, 1970 and January 1, 1972.

PTP always measures fixed-length seconds, so how should we display
dates between January 1, 1970 and January 1, 1972?  I suggest that
such times be displayed by pretending that fixed-length seconds
were being used during that time.  Thus, converting a PTP time
to text for display will show a time that does not correspond to
contemporary civil time between January 1, 1970 and January 1, 1972.

The code is similar to the previous example, but using
fixed-length seconds before 1972.  The display is intended to be
more readable than the ISO 8601 format used in the previous example.
PTP times \num{15638408} and \num{47174409} correspond to the leap
seconds that are needed to keep a count of fixed-length seconds
synchronized with the rotation of the Earth.

\inputminted[firstline=41,lastline=74]{c}{examples/example_05.c}
\embedfile[desc={Example code for PTP}
  mimetype={text/plain},
  ucfilespec={examples/example\_05.c}]
          {examples/example_05.c}

\subsection{Displaying PTP time stamps using Python}
\label{example:PTP_using_Python}
We wish to display PTP time stamps as in the previous example,
but we prefer to code in Python.

\inputminted[firstline=27,lastline=71]{Python}{examples/example_06.py}
\embedfile[desc={Example Python code for PTP}
  mimetype={text/plain},
  ucfilespec={examples/example\_06.py}]
          {examples/example_06.py}

\subsection{Displaying Local Time in Another Time Zone}
Howard E. Hinnant has an excellent package of time subroutines
for C++ at this URL:
\href{https://howardhinnant.github.io/date/tz.html}{https://howardhinnant.github.io/date/tz.html}.
One of his examples is displaying the local time of arrival of a flight
from New York City to Tehran, leaving on December 31, 1978 at 12:01 PM
local time and flying for 14 hours and 44 minutes.  Local time in
New York is 5 hours behind UTC and in Tehran is 3 hours 30 minutes
ahead of UTC, so you might expect the plane to arrive on
January 1, 1979, at 11:15, but in fact the local time of arrival
is 11:14:59 because of the leap second while the plane was in flight.

Here is Python code to compute the Tehran local time of arrival,
assuming it is run at the departure location.

\inputminted[firstline=27,lastline=91]{Python}{examples/example_07.py}
\embedfile[desc={Example Python code for PTP}
  mimetype={text/plain},
  ucfilespec={examples/example\_07.py}]
          {examples/example_07.py}

Note that this code must have the UTC offset and the abbreviation
of Tehran's time zone as constants, rather than extracting them
from the time zone data base, as Howard's example does.

Another good resource for time zone information is
the International Components for Unicode, at
\href{http://site.icu-project.org}{http://site.icu-project.org}.
See the Date/Time Services under ICU User Guide.

\section{Limitations}
\subsection{Unpredictable Rotation of the Earth}
The rotation rate of the Earth is not predictable far in advance.  It must
be observed, like the weather.  To say this another way, we do not know
exactly when the Sun will rise a year from now.  Because Coordinated
Universal Time is tied to the rotation of the Earth, it is similarly
uncertain.

We have increasingly good records of the rotation rate of the Earth
from the time
of the invention of the telescope and the pendulum clock until
the present.  Prior to \num{1825}, the measurements become uncertain.
Efforts have been made to improve our knowledge of the rotation
rate of the Earth in historical times\citep{2004JHA....35..327M}%
\citep{2005JHA....36..339M}\citep{1997A&A...322..347S}%
\citep{2011ASSP...23....3S}\citep{1986PEPI...44..281M}%
\citep{Stephenson20160404}\citep{Stephenson20210217}.
This software carries a table in file {\filename extraordinary\_days.dat}
that reaches back to the year \num{-2000} and forward to
the year \num{2500} based on the latest research on the rotation
of the Earth.
Beyond the table, the software makes predictions which become less
reliable the further out you go.

The table will be updated from time to time to capture present
observations of the Earth's rotation and better estimates from
historical times.  If your application deals with times before
\num{1825} or more than six months in the future, you should recompute
your times whenever the DTAI table is updated.  In the example
of the rocket over Central Park, if you had pre-computed the times
in 2015, you might have missed the leap second at the end of
December 31, 2016.  The update to the DTAI table in the middle
of 2016 should cause the schedule for the remainder of the year
to be recomputed, resulting in a launch time of 23:59:59 for
the December 31 rocket, instead of 23:59:58.

If your application deals only with days, and is not sensitive
to the exact number of seconds between two times, you can be
more relaxed.

\subsection{Only coded for GNU/Linux}
The code embedded in this PDF has been written for GNU/Linux.
Some effort would be required to port the code to another
operating system.

\section{Kernel Recommendations}
\label{section:KernelRecommendations}
Most of the work needed to handle UTC correctly is done in application
programs, but some kernel changes would result in better UTC support.
\begin{enumerate}
\item Add a named clock, called {\ttfamily CLOCK\_UTC}, which uses
  a {\ttfamily timeval} in which the nanoseconds field has
  \num[retain-unity-mantissa = false]{1e9} added to
  indicate a leap second.  This would allow the clock to be set
  during a leap second.
\item Add a kernel boot parameter (perhaps in conjunction with
  an NTP configuration option) to specify the behavior of
  {\ttfamily CLOCK\_REALTIME}.
  Choices are:
  \begin{enumerate}
  \item The same as the old behavior, where during a leap second
    23:59:59 is repeated and {\ttfamily adjtimex} returns
    {\ttfamily TIME\_OOP}.  This is the default, for compatibility.
  \item Smeared time, where the clock begins to depart from UTC several hours
    before the leap second, reaches its maximum at the leap second, then
    returns to UTC over the next several hours.  {\ttfamily Adjtimex}
    never returns {\ttfamily TIME\_OOP} and no second is repeated.
    Reasonable choices for the total smear time are 24 and 48 hours.
    Clock smearing is used to mask leap seconds from software that isn't
    prepared to handle them.
  \item The same as {\ttfamily CLOCK\_UTC}.
  \end{enumerate}
\item When file systems store their mtime, atime and ctime, they use
  the value returned by {\ttfamily CLOCK\_REALTIME}.  Provided that
  {\ttfamily CLOCK\_REALTIME} is set to behave like {\ttfamily CLOCK\_UTC}
  this fixes the inaccuracy of file times.
\end{enumerate}

\section{Future Work}
The table of leap seconds will need to be updated every six months,
when the IERS releases Bulletin C with a new leap second announcement.
These updates can also capture the latest research on the rotation
of the Earth in historical times.  It would be nice if these updates
could be included in the software automatically.

\section{Licensing}
\label{section:Licensing}
As noted on the first page, this paper is licensed under a Creative
Commons Attribution-ShareAlike 4.0 International License.  The code
presented here, and embedded in the PDF file, is licensed under
the GPL, version 3 or later.
\embedfile[desc={General Public License version 3},
  mimetype={text/plain},
  ucfilespec={LICENSE}]
          {LICENSE}

The full text of the Creative Commons Attribution-ShareAlike 4.0
International license is at this web site:
\href{https://creativecommons.org/licenses/by-sa/4.0/legalcode}{https://creativecommons.org/licenses/by-sa/4.0/legalcode}%
\embedfile[desc={Plaintext version of Creative Commons BY-SA 4.0 license},
  mimetype={text/plain},
  ucfilespec={legalcode.txt}]
          {legalcode.txt}, and is embedded in this
PDF file.  What follows is a human-readable summary of it.

\subsection{You are free to:}
\begin{description}
\item[Share ---]copy and redistribute the material in any medium or format, and
\item[Adapt ---]remix, transform, and build upon the material
\end{description}
for any purpose, even commercially.  The licensor cannot revoke these
freedoms as long as you follow the license terms.
\subsection{Under the following terms:}
\begin{description}
\item[Attribution ---]You must give appropriate credit\footnote{If supplied,
  you must provide the name of the creator and attribution parties,
  a copyright notice, a license notice, a disclaimer notice, and a link
  to the material.}, provide a link to
  the license, and indicate if changes were made\footnote{You must indicate if
    you modified the material and retain an indication of previous
    modifications.}.  You may do so in any
  reasonable manner, but not in any that suggests the licensor endorses you
  or your use.
\item[ShareAlike ---]If you remix, transform, or build upon the material,
  you must distribute your contributions under the same
  license\footnote{You may also use any of the licenses listed as compatible
    at the following web site:
    \href{https://creativecommons.org/compatiblelicenses}{https://creativecommons.org/compatiblelicenses}}
  as the original.
\item[No additional restrictions ---]You may not apply legal terms or
  technological measures\footnote{The license prohibits application of
    effective technological measures, defined with reference to Article 11
    of the WIPO Copyright Treaty.}
  that legally restrict others from doing anything
  the license permits.
\end{description}
\subsection{Notices:}
\begin{itemize}
\item{You do not have to comply with the license for elements of the
  material in the public domain or where your use is permitted by an
  exception or limitation.}
\item{No warranties are given.  The license may not give you all of the
  permissions necessary for your intended use.  For example, other rights
  such as publicity, privacy or moral rights may limit how you use the
  material.}
\end{itemize}

\section{Revision History}

\begin{description}
\item[2024-01-05 5.148.2]Adjust future leap seconds starting in 2308.
\item[2023-12-29 5.147.2]Adjust future leap seconds starting in 2189.
\item[2023-12-22 5.146.2]Adjust future leap seconds starting in 2140.
\item[2023-12-15 5.145.2]Adjust future leap seconds starting in 2170.
\item[2023-12-08 5.144.2]Adjust future leap seconds starting in 2199.
\item[2023-12-01 5.143.2]Adjust future leap seconds starting in 2140.
\item[2023-11-25 5.142.2]Adjust future leap seconds starting in 2189.
\item[2023-11-17 5.141.2]Adjust future leap seconds starting in 2056.
\item[2023-11-03 5.140.2]Adjust future leap seconds starting in 2081.
\item[2023-10-29 5.139.2]Adjust future leap seconds starting in 2060.
\item[2023-10-28 5.138.2]Adjust future leap seconds starting in 2439.
\item[2023-10-20 5.137.2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on December 31, 2029.
\item[2023-10-13 5.136.2]Adjust future leap seconds starting in 2400.
\item[2023-10-07 5.135.2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on June 30, 2029.
\item[2023-09-29 5.134.2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a positive leap second
  on on December 31, 2047.
  Remove support of RHEL, which only worked for RHEL 8.
\item[2023-09-22 5.133.2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on June 30, 2029.
\item[2023-09-17]Remove redundant code in int128\_to\_string
  found by Facebook / infer.
\item[2023-09-15 5.132.2]Adjust future leap seconds starting in 2034.
  The next leap second is predicted to be a negative leap second
  on December 31, 2034.
\item[2023-09-08 5.131.2]Adjust future leap seconds starting in 2419.
\item[2023-09-01 5.130.2]Adjust future leap seconds starting in 2419.
\item[2023-08-18 5.129.2]Adjust future leap seconds starting in 2132.
\item[2023-08-11 5.128.2]Adjust future leap seconds starting in 2407.
\item[2023-08-04 5.127.2]Adjust future leap seconds starting in 2034.
  The next leap second is predicted to be a negative leap second
  on December 31, 2034.
\item[2023-07-28 5.126.2]Adjust future leap seconds starting in 2271.
\item[2023-07-21 5.125.2]Adjust future leap seconds starting in 2033.
  The next leap second is predicted to be a negative leap second
  on June 30, 2034.
\item[2023-07-14 5.124.2]Adjust future leap seconds starting in 2167.
\item[2023-07-07 5.123.2]Adjust future leap seconds starting in 2082.
\item[2023-06-30 5.122.2]Adjust future leap seconds starting in 2328.
\item[2023-06-23 5.121.2]Adjust future leap seconds starting in 2033.
  The next leap second is predicted to be a negative leap second
  on December 31, 2033.
\item[2023-06-16 5.120.2]Adjust future leap seconds starting in 2067.
\item[2023-06-09 5.119.2]Adjust future leap seconds starting in 2172.
\item[2023-06-02 5.118.2]Adjust future leap seconds starting in 2032.
  The next leap second is predicted to be a negative leap second
  on June 30, 2033.
\item[2023-05-26 5.117.2]Adjust future leap seconds starting in 2032.
  The next leap second is predicted to be a negative leap second
  on December 31, 2032.
\item[2023-05-19 5.116.2]Adjust future leap seconds starting in 2184.
\item[2023-05-13 5.115.2]Copy editing and fix overflow of Python code
  beyond the margin.
\item[2023-05-12 5.115.2]Adjust future leap seconds starting in 2031.
  The next leap second is predicted to be a negative leap second
  on June 30, 2032.
\item[2023-05-05 5.114.2]Adjust future leap seconds starting in 2031.
  The next leap second is predicted to be a negative leap second
  on December 31, 2031.
\item[2023-04-28 5.113.2]Adjust future leap seconds starting in 2119.
\item[2023-04-21 5.112.2]Adjust future leap seconds starting in 2119.
\item[2023-04-14 5.111.2]Adjust future leap seconds starting in 2120.
\item[2023-04-07 5.110.2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be a negative leap second
  on June 30, 2031.
\item[2023-03-24 5.109.2]Adjust future leap seconds starting in 2117.
\item[2023-03-24 5.108.2]Adjust future leap seconds starting in 2093.
\item[2023-03-17 5.107.2]Adjust future leap seconds starting in 2063.
\item[2023-03-10 5.106.2]Adjust future leap seconds starting in 2122.
\item[2023-03-03 5.105.2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be a negative leap second
  on December 31, 2030.
\item[2023-02-24 5.104.2]Correct a URL.  Adjust future leap seconds
  starting in 2098.
\item[2023-02-17 5.103.2]Adjust future leap seconds starting in 2190.
\item[2023-02-10 5.102.2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on June 30, 2030.
\item[2023-02-03 5.101.2]Adjust future leap seconds starting in 2229.
\item[2023-01-27 5.100.2]Adjust future leap seconds starting in 2063.
\item[2023-01-13 5.99.2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on December 31, 2029.
  Update to IERS Bulletin C 65,
  issued January 9, 2023, which states that UTC -- TAI
  will remain at \num{-37} seconds for the next six months, at least.
\item[2023-01-11 5.98.2]Move the URLs of the documents from Google Drive
  to System Eyes Computer Store.
\item[2023-01-06 5.98.2]Adjust future leap seconds starting in 2038.
\item[2022-12-30 5.97.2]Adjust future leap seconds starting in 2169.
\item[2022-12-23 5:96:2]Adjust future leap seconds starting in 2028.
  The next leap second is predicted to be a negative leap second
  on June 30, 2029.
\item[2022-12-16 5:95:2]Adjust future leap seconds starting in 2214.
\item[2022-12-09 5:94:2]Adjust future leap seconds starting in 2037.
\item[2022-12-02 5:93:2]Adjust future leap seconds starting in 2256.
\item[2022-11-25 5:92:2]Adjust future leap seconds starting in 2069.
\item[2022-11-18 5:91:2]Adjust future leap seconds starting in 2069.
\item[2022-11-11 5:90:2]Adjust future leap seconds starting in 2028.
  The next leap second is predicted to be a negative leap second
  on December 31, 2028.
\item[2022-11-04 5:89:2]Adjust future leap seconds starting in 2197.
\item[2022-10-28 5:88:2]Adjust future leap seconds starting in 2036.
\item[2022-10-21 5:87:2]Adjust future leap seconds starting in 2108.
\item[2022-10-14 5:86:2]Adjust future leap seconds starting in 2027.
  The next leap second is predicted to be a negative leap second
  on June 30, 2028.
\item[2022-09-16 5:85:2]Adjust future leap seconds starting in 2027.
  The next leap second is predicted to be a negative leap second
  on December 31, 2027.
\item[2022-09-09 5:84:2]Adjust future leap seconds starting in 2135.
\item[2022-08-12 5:83:2]Adjust future leap seconds starting in 2064.
\item[2022-08-05 5:82:2]Adjust future leap seconds starting in 2064.
\item[2022-07-22 5:81:2]Adjust future leap seconds starting in 2036.
\item[2022-07-08 5:80:2]Update to IERS Bulletin C 64,
  issued July 5, 2022.
  There will be no leap second at the end of December, 2022.
  Adjust future leap seconds starting in 2036.
\item[2022-05-27 5:79:2]Adjust future leap seconds starting in 2028.
  The next leap second is predicted to be a negative leap second
  on June 30, 2028.
\item[2022-06-10 5:78:2]Adjust future leap seconds starting in 2037.
\item[2022-05-27 5:77:2]Adjust future leap seconds starting in 2028.
  The next leap second is predicted to be a negative leap second
  on December 31, 2028.
\item[2022-05-26 5:76:2]Update the URL on the front page.
\item[2022-05-13 5:76:2]Adjust future leap seconds starting in 2028.
  The next leap second is predicted to be a negative leap second
  on June 30, 2029.
\item[2022-05-06 5:75:2]Adjust future leap seconds starting in 2028.
  The next leap second is predicted to be a negative leap second
  on December 31, 2028.
\item[2022-04-29 5:74.2]Adjust future leap seconds starting in 2038.
\item[2022-04-15 5:73:2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on June 30, 2029.
\item[2022-04-01 5:72:2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be a negative leap second
  on December 31, 2029.
\item[2022-03-18 5:71:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be a negative leap second
  on June 30, 2030.
\item[2022-03-11 5:70:2]Adjust future leap seconds starting in 2062.
\item[2022-03-08 5:69:2]Try out the EB Garamond font.
\item[2022-02-25 5:69:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be a negative leap second
  on December 31, 2030.  The Andika font needs more work---I need to
  find a good monospaced companion.  Return to GNU free fonts.
\item[2022-02-21 5:68:2]Try out the Andika font.
\item[2022-02-20 5:68:2]Adjust future leap seconds starting in 2068.
\item[2022-02-19 5:67:2]Correct the date on the front page of the PDF.
\item[2022-02-18 5:67:2]Adjust future leap seconds starting in 2141.
\item[2022-01-07 5:66:2]Adjust future leap seconds starting in 2155.
  Update to IERS Bulletin C 63, saying there will be no leap second
  at the end of June, 2022.
\item[2021-12-10 5:65:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be a negative leap second
  on June 30, 2031.
\item[2021-11-19 5:64:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be a negative leap second
  on December 31, 2030.
\item[2021-11-12 5:63:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be on June 30, 2031, and it
  will be a negative leap second.
\item[2021-10-29 5:62:2]Adjust future leap seconds starting in 2068.
\item[2021-10-15 5:61:2]Adjust future leap seconds starting in 2062.
\item[2021-09-26 5:60:2]Move my documents from Wikimedia to Google Drive.
\item[2021-09-24 5:60:2]Adjust future leap seconds starting in 2062.
\item[2021-09-10 5:59:2]Adjust future leap seconds starting in 2072.
\item[2021-08-20 5:58:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be on December 31, 2030, and it
  will be a negative leap second.
\item[2021-07-30 5:57:2]Adjust future leap seconds starting in 2076.
\item[2021-07-23 5:56:2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be on June 30, 2030, and it
  will be a negative leap second.
\item[2021-07-09 5:55:2]Adjust future leap seconds starting in 2412.
  Update to IERS Bulletin C 62, saying there will be no leap second
  at the end of December, 2021.
\item[2021-07-02 5:54:2]Adjust future leap seconds starting in 2088.
\item[2021-06-25 5:53:2]Adjust future leap seconds starting in 2091.
\item[2021-06-18 5:52:2]Adjust future leap seconds starting in 2352.
\item[2021-06-11 5:51:2]Adjust future leap seconds starting in 2287.
\item[2021-06-04 5:50:2]Adjust future leap seconds starting in 2063.
\item[2021-05-28 5:49:2]Adjust future leap seconds starting in 2182.
\item[2021-05-21 5:48:2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be on December 31, 2029, and
  it will be a negative leap second.
\item[2021-05-14 5:47:2]Adjust future leap seconds starting in 2073.
\item[2021-05-07 5:46:2]Adjust future leap seconds starting in 2357.
\item[2021-04-23 5:45:2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be on June 30, 2029, and
  it will be a negative leap second.
\item[2021-04-16 5:44:2]Adjust future leap seconds starting in 2245.
\item[2021-04-09 5:43:2]Adjust future leap seconds starting in 2063.
\item[2021-04-02 5:42:2]Adjust future leap seconds starting in 2029.
  The next leap second is predicted to be on December 31, 2029, and
  it will be a negative leap second.
\item[2021-03-26 5:41:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be on June 30, 2030, and
  it will be a negative leap second.
\item[2021-03-19 5:40:2]Adjust future leap seconds starting in 2068.
\item[2021-03-12 5:39:2]Adjust future leap seconds starting in 2030.
  The next leap second is predicted to be on December 31, 2030,
  and it will be a negative leap second.
\item[2021-03-05 5:38:2]Include the latest research on historical values
  of delta T.  Adjust essentially all leap seconds before 1825 and
  in the future.  The next leap second is predicted to be on June 30, 2031,
  and it will be a negative leap second.
\item[2021-03-03 5:37:2]Suggest pdfdetach rather than okular
  for extracting files from the PDF.
\item[2021-02-26 5:37:2]Adjust future leap seconds starting in 2104.
\item[2021-02-19 5:36:2]Adjust future leap seconds starting in 2051.
\item[2021-02-12 5:35:2]Adjust future leap seconds starting in 2103.
\item[2021-02-05 5:34:2]Adjust future leap seconds starting in 2055.
\item[2021-01-31 5:33:2]Switch back to the Libertine font.
\item[2021-01-29 5:33:2]Adjust future leap seconds starting in 2089.
\item[2021-01-25 5:32:2]Do not send random bits to mktime.
\item[2021-01-22 5:32:2]Adjust future leap seconds starting in 2070.
\item[2021-01-15 5:31:2]Adjust future leap seconds starting in 2039.
\item[2021-01-08 5:30:2]Update to IERS Bulletin C 61, issued
  January 7, 2021, saying that there will be no leap second
  at the end of June, 2021.
  Adjust future leap seconds starting in 2105.
\item[2021-01-01 5:29:2]Adjust future leap seconds starting in 2064.
\item[2020-12-25 5:28:2]Adjust future leap seconds starting in 2077.
\item[2020-12-18 5:27:2]Adjust future leap seconds starting in 2044.
\item[2020-12-04 5:26:2]Adjust future leap seconds starting in 2070.
\item[2020-11-27 5:25:2]Adjust future leap seconds starting in 2097.
\item[2020-11-20 5:24:2]Adjust future leap seconds starting in 2067.
\item[2020-11-15 5:23:2]Update file {\filename fix\_files.sh}
  to include {\filename example\_07.py}.
\item[2020-11-13 5:23:2]Convert this document to the Garamond font.
  Delay the December 2093 leap second by six months to June 2094.
\item[2020-11-06 5:22:2]Adjust future leap seconds starting in 2033.
\item[2020-10-30 5:21:2]Adjust future leap seconds starting in 2033.
\item[2020-10-23 5:20:2]Adjust future leap seconds starting in 2033.
\item[2020-10-16 5:19:2]Adjust future leap seconds starting in 2062.
\item[2020-10-02 5:18:2]Adjust future leap seconds starting in 2059.
\item[2020-09-25 5:17:2]Adjust almost all future leap seconds
  starting in 2032.
\item[2020-09-04 5:16:2]Adjust almost all future leap seconds.
\item[2020-08-28 5:15:2]Adjust future leap seconds starting in 2089.
\item[2020-08-21 5:14:2]Adjust future leap seconds starting in 2031.
\item[2020-08-14 5:13:2]Adjust future leap seconds starting in 2073.
\item[2020-08-07 5:12:2]Adjust future leap seconds starting in 2114.
\item[2020-07-31 5:11:2]Adjust future leap seconds starting in 2120.
\item[2020-07-24 5:10:2]Adjust future leap seconds starting in 2055.
\item[2020-07-17 5:9:2]Adjust future leap seconds starting in 2080.
\item[2020-07-10 5:8:2]Update to IERS Bulletin C 60, issued
  July 8, 2020.  There will be no leap second at the end of
  December, 2020.  Adjust future leap seconds starting in 2066.
\item[2020-07-03 5:7:2]Adjust many future leap seconds starting in 2025.
\item[2020-06-26 5:6:2]Adjust many future leap seconds starting in 2068.
\item[2020-06-19 5:5:2]Adjust many future leap seconds starting in 2063.
\item[2020-06-12 5:4:2]Adjust many future leap seconds starting in 2098.
\item[2020-06-05 5:3:2]Adjust many future leap seconds starting in 2087.
\item[2020-05-29 5:2:2]Adjust many future leap seconds starting in 2106.
\item[2020-05-21 5:1:2]Adjust several distant future leap seconds.
\item[2020-05-14 5:0:2]Add time\_utc\_to\_foreign\_local.
  Adjust five distant future leap seconds.
\item[2020-05-07 4:15:1]Adjust five distant future leap seconds.
\item[2020-04-30 4:14:1]Convert to Libertine fonts.  Adjust several distant
  future leap seconds.
\item[2020-04-23 4:13:1]Advance three distant future leap seconds
  by three or six months.
\item[2020-04-16 4:12:1]Advance seven distant future leap seconds
  by three or six months.
\item[2020-04-15 4:11:1]Recompute all future leap seconds.
\item[2020-04-14 4:10:1]Recompute all future leap seconds.
\item[2020-04-10 4:9:1]Delay the next five leap seconds.
\item[2020-04-03 4:8:1]Update the README file to include Fedora 32.
\item[2020-03-20 4:8:1]Delay the December 2028 leap second by six months
  to June 2029.
\item[2020-02-21 4:7:1]Delay the December 2023 leap second by six months
  to June 2024.
\item[2020-02-15 4:6:1]Delay the June 2033 leap second by six months
  to December 2033.
\item[2020-01-31 4:5:1]Delay the December 2042 leap second by six months
  to June 2043.
\item[2020-01-25 4:4:1]Delay the June 2023 leap second by six months
  to December 2023 and the June 2028 leap second by six months to December 2028.
\item[2020-01-11 4:3:1]Update to IERS Bulletin C 59, issued January 7, 2020.
  There will be no leap second at the end of June 2020.
\item[2020-01-03 4:2:1]Delay the December 2022 leap second by six months
  to June 2023.
\item[2019-12-20 4:1:1]Delay the December 2032 leap second by six months
  to June 2033.
\item[2019-12-14 4:0:1]Add {\ttfamily time\_test\_for\_disabled\_adjtimex}.
\item[2019-12-13 3:20:0]Delay the December 2027 leap second by six months
  to June 2028 and the December 2032 leap second by six months to June 2033.
\item[2019-12-06 3:19:0]Delay the June 2022 leap second by six months
  to December 2022.
\item[2019-12-02 3:18:0]Place the source RPM on github.
\item[2019-11-29 3:17:0]Add a test for adjtimex not working.
  Mock or container bug reported in Fedora bugzilla 1778298.
\item[2019-11-24 3:16:0]Remove dependency on jdcal, so we can build
  on more platforms.
\item[2019-11-23 3:16:0]Delay the June 2027 leap second by six months
  to December 2027.
\item[2019-11-16 3:15:0]Make dependence on 128-bit integers optional.
  Delay the June 2032 leap second by six months to December 2032.
\item[2019-11-09 3:14:0]Simplify the Makefile and clean up the
  test programs for rpmbuild.  Include a spec file in the tarball
  for two RPMs: libtime and libtime-devel.  Move the source
  files to their own subdirectory, the example files to theirs,
  and the test and demo files to theirs.
\item[2019-10-31 3:13:0]Delay the December 2021 leap second by
  six months to June 2022 and the June 2037 leap second by six
  months to December 2037.
\item[2019-10-11 3:12:0]Delay the December 2026 leap second by
  six months to June 2027, and the June 2042 leap second by six
  months to December 2042.  Improve the internal description of
  Julian Day Number.
\item[2019-10-04 3:11:0]Delay the December 2031 leap second by
  six months to June 2032.
\item[2019-09-20 3:10:0]Delay the June 2021 leap second by six
  months to December 2021.
\item[2019-09-07 3:9:0]Delay the June 2026 leap second by six months
  to December 2026.
\item[2019-08-17 3:8:0]Delay the December 2036 leap second by six
  months to June 2037.
\item[2019-07-27 3:7:0]Update the leap seconds before 1840 based
  on the latest research on the rotation of the Earth.
\item[2019-07-04 3:6:0]Update to IERS Bulletin C 58, issued July
  4, 2019, which states that no leap second will be introduced
  at the end of December 2019, so UTC -- TAI will remain at
  \num{-37} seconds for the next six months, at least.  
\item[2019-06-22 3:5:0] Be more careful with the definition
  and display of Julian Day Numbers.
\item[2019-06-16 3:4:0] Delay the June 2020 leap second to
  June of 2021, and generally revise the leap second schedule
  by using a new algorithm to predict them.
\item[2019-06-09 3:3:0] Delay the June 2076 leap second by
  six months to December of 2076.
\item[2019-06-04 3:2:0] Delay the June 2036 leap second by
  six months to December of 2036.  Say more about Python.
\item[2019-05-19 3:1:0] Delay the December 2050 leap second
  by six months to June of 2051.  Add a Python example.
\item[2019-04-28 3:0:0] Add support for Python.  Int128\_to\_string
  now takes its value argument by reference instead of by value.
\item[2019-04-20 2:11:0] Delay the December 2039 leap second
  to June of 2040.
\item[2019-04-09 2:10:0] Advance the June 2040 leap second back to
  December 2039.  Show the predictions for the next two leap seconds.
\item[2019-03-30 2:9:0] Delay the December 2039 leap second by six
  months to June 2040, and delay the June 2065 leap second by six
  months to December 2065.
\item[2019-03-24 2:8:0] Return the next leap second to June 30, 2020,
  and adjust some of the leap second predictions for the rest of the
  twenty-first century.
\item[2019-03-16 2:7:0] Advance the next leap second from June 30, 2020
  to December 31, 2019, and adjust the leap second predictions
  for the rest of the century.
\item[2019-01-20 2:6:0] Advance the June 2095 leap second by six
  months, returning it to December 2094.
\item[2019-01-12 2:5:0] Update to IERS Bulletin C 57, issued January
  7, 2019, which states that no leap second will be introduced
  at the end of June 2019, so UTC -- TAI will remain at
  \num{-37} seconds for the next six months, at least.  
\item[2018-12-23 2:4:0] Delay the December 2094 leap second by six month
  to June 2095.
\item[2018-12-02 2:3:0] Add information on converting IEEE 1588 (PTP)
  times to readable text.
\item[2018-12-01 2:2:0] Delay the December 2077 leap second by
  six months to June 2078.
\item[2018-11-25 2:1:0] Improve the algorithm for anticipating future
  leap seconds.
\item[2018-11-11 2:0:0] Changed ``variable length seconds before 1972''
  to ``variable length seconds before year''.  This additional flexibility
  is in honor of Microsoft Windows, which will be counting leap seconds
  after January 1, 2019.
\item[2018-10-04 1:15:0] Update the list of dependencies in the
  README file for Fedora 29.
\item[2018-09-30 1:14:0] Improve the prediction of future leap seconds.
\item[2018-09-22 1:13:0] Move the prediction of the next leap second
  from December 31, 2020 to June 30, 2020 based on predictions of
  the Earth's rotation by the IERS projected into the future.
\item[2018-07-15 1:12:0] Update to IERS Bulletin C 56, issued July
  5, 2018, which states that no leap second will be introduced
  at the end of December 2018, so UTC -- TAI will remain at
  \num{-37} seconds for the next six months, at least.
\item[2018-05-20 1:11:0] Move the prediction of the next leap second
  from June 30, 2020 to December 31, 2020 based on predictions of
  the Earth's rotation by the IERS projected into the future.
\item[2018-05-06 1:10:0] Move the prediction of the next leap second
  from December 31, 2020 to June 30, 2020 based on predictions
  of the Earth's rotation from the IERS projected into the future.
\item[2018-01-15 1:9:0] Update to IERS Bulletin C 55, issued
  January 9, 2018, which states that no leap second will be introduced
  at the end of June 2018 so UTC -- TAI will remain at \num{-37} seconds
  for the next six months, at least.
\item[2017-12-04 1:8:0] Add information about International Atomic Time.
\item[2017-11-19 1:7:0] Add support for pkg-config, make check and
  make distcheck.  Recommend CLOCK\_BOOTTIME rather than of CLOCK\_MONOTONIC
  because CLOCK\_MONOTONIC stops counting when the computer is suspended,
  and therefore can change its epoch while an application is running.
\item[2017-10-08 1:6:0] Improve the MAN page.
\item[2017-09-17 1:5:0] Place on github.
\item[2017-08-27 1:4:0] Add a MAN page.
\item[2017-07-08 1:3:0] Use Automake in the build procedure.
  Distribute the software using the customary GNU packaging,
  with the PDF file as its documentation.  Continue to include
  the software in the PDF as embedded files.  Build the PDF
  only if requested.  Update to IERS Bulletin C 54, issued
  July 6, 2017, which states that no leap second will be introduced
  at the end of December, 2017, so UTC -- TAI will remain at
  \num{-37} seconds for the next six months, at least.
\item[2017-05-07 1:2:0] Minor typographical changes, add test\_local.c,
  work around compiler over-optimization in int128\_to\_string.
\item[2017-01-27 1:1:0] Update the Makefile and some of the test programs
  based on feedback from Steve Summit.
\item[2017-01-18 1:0:0] Added the ability to use variable length seconds
  before 1972.
\item[2017-01-10 0:2:0] Updated to IERS Bulletin C 53,
  issued January 9, 2017, which states that UTC -- TAI
  will remain at \num{-37} seconds for the next six months, at least.
\item[2017-01-01 0:1:0] Added a description of the stat function,
  the list of entry points and the kernel recommendations.
  Handle converting $-2^{127}$ to a string. 
\item[2016-12-21 0:0:0] Original distribution.
\end{description}

\bibliography{references}
\embedfile[desc={Bibliography},mimetype={text/plain},
  ucfilespec={references.bib}]
          {references.bib}

\end{document}
